#!/usr/local/bin/node ./lix.js
Fiber := 'fibers' require 

cc := (proc)->{
	caller := Fiber.current
	proc call (i)->{
		caller .run i 
	}
	Fiber .yield
}

FiberProc := (fn)->{
	()->{
		fn call
		process .exit
	} | Fiber | .run
}

FiberProc call ()->{

	ret := cc call (brk)->{
		()->{
			'before' console.log
			'hello world' brk
			'after' console.log
		} setTimeout 1
	}

	ret print
} 

'main exit' | print
