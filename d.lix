#!/usr/local/bin/node

sleep := (ms)->{
	cc call (brk)->{
		ms timeout ()->{
			brk call
		}
	}
}

getCurrentContinuation := ()->{
	cont := null
	cc call (brk)->{
		cont = brk
		brk call
	}
	cont
}

genTimeBack := (limit)->{
	count := 0
	(cont)->{
		count = count + 1
		if (count <= limit) {
			cont call
		}
	}
}

timeBack := genTimeBack call 5
breakpoint := getCurrentContinuation call

'good' print
500 sleep

timeBack call breakpoint

'end' print

